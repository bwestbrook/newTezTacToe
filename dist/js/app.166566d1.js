(function(){var e={9693:function(e,t,i){"use strict";var n=i(3751),s=i(641);const o={class:"body"};function a(e,t,i,n,a,r){const l=(0,s.g2)("mainBody");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(l,{class:"centerMiddle",wallet:a.wallet,walletAddress:a.walletAddress,socket:a.socket,tezos:a.tezos,windowWidth:a.windowWidth,windowHeight:a.windowHeight},null,8,["wallet","walletAddress","socket","tezos","windowWidth","windowHeight"])])}var r=i(3437),l=i(3750),c=i(6900),d=i(4787);const h={class:"mainBody"},u={class:"centerBody"};function m(e,t,i,n,o,a){const r=(0,s.g2)("playerControl"),l=(0,s.g2)("gameGrid");return(0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",u,[(0,s.bF)(r,{socket:i.socket,wallet:i.wallet,tezos:i.tezos,walletAddress:i.walletAddress},null,8,["socket","wallet","tezos","walletAddress"]),(0,s.bF)(l,{windowHeight:i.windowHeight,windowWidth:i.windowWidth,socket:i.socket},null,8,["windowHeight","windowWidth","socket"]),t[0]||(t[0]=(0,s.Lk)("div",{class:"rules"},null,-1)),t[1]||(t[1]=(0,s.Lk)("div",null,"aaaaaaaaa",-1))])])}const w={class:"canvas-container"};function g(e,t,i,n,o,a){return(0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("div",{class:"gameBox",onMousedown:t[0]||(t[0]=(...e)=>a.checkClickDown&&a.checkClickDown(...e)),onMouseup:t[1]||(t[1]=(...e)=>a.checkClickUp&&a.checkClickUp(...e)),onMousemove:t[2]||(t[2]=(...e)=>a.highlightMove&&a.highlightMove(...e)),onClick:t[3]||(t[3]=(...e)=>a.makeMove&&a.makeMove(...e)),ref:"container"},null,544)])}var f=i(4922),v=i(9437),p=i(7024),y={name:"gameGrid",data(){return{width:10,rotate:!1,playX:0,playY:0,clickX:0,clickY:0,cameraX:0,cameraY:0,moveMade:!1,playerColor:"red",playerTurn:1,gamePaused:!1,halfTurn:!1,player1Plays:{},player2Plays:{}}},props:["socket","activeGameId","windowWidth","windowHeight"],created(){this.intvl=.3,this.gameSize=.6*this.windowWidth,this.board=new f.YJl,this.defaultGeometry=new f.Gu$(.05,32,16),this.defaultMaterial=new f.qBx,this.highlightGeometry=new f.iNn(.1,.1,.1),this.highlightMaterial=new f.FNr({color:"green"}),this.player1Geometry=new f.iNn(.1,.1,.1),this.player1Material=new f.FNr({color:"red",opacity:.5}),this.player2Geometry=new f.iNn(.1,.1,.1),this.player2Material=new f.FNr({color:"blue",opacity:.5}),this.scene=new f.Z58,this.renderer=new v.JeP({antialias:!0}),this.renderer.setSize(this.gameSize,this.gameSize),this.camera=new f.ubm(45,1,.5,5e3),this.camera.position.x=2,this.camera.position.y=.5,this.camera.position.z=2,this.camera.lookAt(this.scene.position)},mounted(){this.buildBoard(),this.socket.emit("initGameGrid",0),this.$refs.container.appendChild(this.renderer.domElement),this.renderer.render(this.scene,this.camera),this.controls=new p.N(this.camera,this.renderer.domElement),this.animate(),this.socket.on("gameGrid",(e=>{this.gameGrid=e})),this.socket.on("resizeGame",(e=>{this.resizeGameRender(e)}))},methods:{animate:function(){this.controls.update(),requestAnimationFrame(this.animate),this.renderer.render(this.scene,this.camera)},checkClickDown:function(e){this.rotate=!0,this.clickX=e.x,this.clickY=e.y,this.playX=e.x,this.playY=e.y},checkClickUp:function(){this.rotate=!1},submitMove:function(){"red"===this.playerColor?this.playerColor="blue":this.playerColor="red"},buildBoard:function(){let e=-1;for(e;e<3;e++){let t=-1;for(t;t<3;t++){let i=-1;for(i;i<3;i++){let n;n=new f.eaF(this.defaultGeometry,this.defaultMaterial),n.position.set(e*this.intvl-.5*this.intvl,t*this.intvl-.5*this.intvl,i*this.intvl-.5*this.intvl),n.coords=[e,t,i],this.board.add(n)}}}this.scene.add(this.board)},highlightMove:function(e){if(this.gamePaused)return;const t=this.findIntersects(e);if(this.updateGridRender(),t.length>0){const e=t[0];e.object.material=this.highlightMaterial,e.object.geometry=this.highlightGeometry}},makeMove:function(e){const t=this.findIntersects(e);if(t.length>0){let e=t[0];const i=e.object.coords[0],n=e.object.coords[1],s=e.object.coords[2];this.gameGrid[i][n][s]<0?(this.gamePaused&&(this.gameGrid[i][n][s]=0),this.gamePaused=!1):(0!=this.gameGrid[i][n][s]||this.gamePaused||(this.gameGrid[i][n][s]=-1*this.playerTurn),this.gamePaused=!0)}this.updateGridRender(),this.socket.emit("updateGameGrid",this.gameGrid)},resizeGameRender:function(e){this.gameSize=.65*e,this.renderer.setSize(this.gameSize,this.gameSize)},updateGridRender:function(){if(!this.gameGrid)return;let e;e=this.board.children;let t=0;for(t;t<e.length;t++){let i;i=e[t];const n=i.coords[0],s=i.coords[1],o=i.coords[2],a=this.gameGrid[n][s][o];0==a?(i.material=this.defaultMaterial,i.geometry=this.defaultGeometry):1==a||-1==a?(i.material=this.player1Material,i.geometry=this.player1Geometry):2==a&&(i.material=this.player2Material,i.geometry=this.player2Geometry)}},findIntersects:function(e){if(this.mouseDown)return[];let t=[];const i=new f.tBo,n=new f.I9Y,s=this.renderer.domElement.getBoundingClientRect().x,o=this.renderer.domElement.getBoundingClientRect().y;return n.x=2*(e.clientX-s)/this.gameSize-1,n.y=-2*(e.clientY-o)/this.gameSize+1,i.setFromCamera(n,this.camera),t=i.intersectObjects(this.scene.children),t},updateGameGrid:function(e){this.gameGrid=e},resizeGame:function(e){this.gameSize=e,this.resizeGameRender()}}},k=i(6262);const G=(0,k.A)(y,[["render",g],["__scopeId","data-v-722a1438"]]);var z=G,b=i(33);const C={class:"playerPanel"};function A(e,t,i,n,o,a){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",C,[(0,s.Lk)("div",{class:"actionButton",onClick:t[0]||(t[0]=(...e)=>a.createGameBC&&a.createGameBC(...e))}," Create Game "),(0,s.Lk)("div",{class:"actionButton",onClick:t[1]||(t[1]=(...e)=>a.joinGameBC&&a.joinGameBC(...e))}," Join/Resume Game "),(0,s.Lk)("div",{class:"actionButton",onClick:t[2]||(t[2]=(...t)=>e.submitMoveBC&&e.submitMoveBC(...t))}," Submit Move "),(0,s.Lk)("div",{class:"actionButton",onClick:t[3]||(t[3]=(...e)=>a.toggleWallet&&a.toggleWallet(...e))},(0,b.v_)(i.walletAddress),1)]),t[4]||(t[4]=(0,s.Lk)("div",{class:"playerPanel"},[(0,s.Lk)("div",null," My Games ")],-1)),t[5]||(t[5]=(0,s.Lk)("div",{class:"playerPanel"},[(0,s.Lk)("div",null," Pending Games ")],-1))],64)}var M=i(5010);const W="https://ghostnet.tezos.ecadinfra.com/",P="KT1BvZ1nhgtEMghqTqqz2UG8rDcjvJrQLomx";var S={name:"playerControl",emits:["submitMove","createGameService"],props:["socket","wallet","tezos","walletAddress"],data(){return{activeGameId:0}},created(){this.socket.emit("updateActiveGame",this.activeGameId)},methods:{async toggleWallet(){const e=await this.wallet.client.getActiveAccount();e?await this.wallet.clearActiveAccount():(await this.wallet.client.requestPermissions(),this.tezos.setWalletProvider(this.wallet))},async createGameBC(){const e=await this.wallet.client.getActiveAccount();if(!e)return;const t=new M.X(e.address,W);await this.tezos.setProvider({signer:t}),await this.tezos.setWalletProvider(this.wallet),this.tezos.wallet.at(P).then((t=>t.methods.startGame(1e3,e.address).send())).then((e=>(console.log(`Waiting for ${e.hash} to be confirmed...`),e.confirmation(1).then((()=>e.hash))))).then((e=>console.log(`Operation injected: https://ghost.tzstats.com/${e}`))).catch((e=>console.log(`Error3: ${JSON.stringify(e,null,2)}`)))},async joinGameBC(){const e=await this.wallet.client.getActiveAccount();if(!e)return;const t=new M.X(e.address,W);await this.tezos.setProvider({signer:t}),await this.tezos.setWalletProvider(this.wallet);const i=0;this.tezos.wallet.at(P).then((t=>t.methods.joinGame(i,e.address).send())).then((e=>(console.log(`Waiting for ${e.hash} to be confirmed...`),e.confirmation(1).then((()=>e.hash))))).then((e=>console.log(`Operation injected: https://ghost.tzstats.com/${e}`))).catch((e=>console.log(`Error3: ${JSON.stringify(e,null,2)}`)))}}};const B=(0,k.A)(S,[["render",A],["__scopeId","data-v-64605752"]]);var j=B,E={name:"HelloWorld",props:["wallet","walletAddress","socket","tezos","windowWidth","windowHeight"],components:{gameGrid:z,playerControl:j},data(){return{}},methods:{},created(){}};const T=(0,k.A)(E,[["render",m],["__scopeId","data-v-807d8936"]]);var O=T;i(4692);const L=async e=>"t."+e.substring(e.length-4);var X=i(7077);const N=new X.cv(W);let x;var H={name:"App",components:{mainBody:O},data(){return{windowHeight:window.innerHeight,windowWidth:window.innerWidth,wallet:this.wallet,tezos:this.tezos,walletAddress:this.walletAddress,socket:this.socket}},methods:{async getWallet(){if(x)this.wallet=x;else{const e=new l.uw({name:"TezTacToe",network:{type:c.z1.GHOSTNET}});e.client.subscribeToEvent(r.JH.ACTIVE_ACCOUNT_SET,(e=>{this.brodcastWallet(e)})),this.wallet=e}return x},async brodcastWallet(e){if(e){const t=await L(e.address);N.setWalletProvider(this.wallet);const i=new M.X(e.address,W);await this.tezos.setProvider({signer:i}),this.walletAddress="UNSYNC WALLET "+t}else this.walletAddress="SYNC WALLET"},async sendTezos(e,t){const i=new M.X(e.address,W);await this.tezos.setProvider({signer:i}),await this.tezos.setWalletProvider(this.wallet),await this.tezos.wallet.transfer({amount:t,to:"tz1Vq5mYKXw1dD9js26An8dXdASuzo3bfE2w"}).send()},async onResize(){this.socket.emit("resizeGame",window.innerWidth)}},created(){this.socket=(0,d.Ay)("https://damp-spire-29654-cc0ffbb43258.herokuapp.com/"),console.log("create"),console.log(this.socket),this.tezos=N,this.getWallet()},mounted(){window.addEventListener("resize",(()=>{this.onResize()}))}};const _=(0,k.A)(H,[["render",a]]);var F=_;(0,n.Ef)(F).mount("#app")},9432:function(){},7790:function(){},3776:function(){},5340:function(){},9838:function(){}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=e,function(){var e=[];i.O=function(t,n,s,o){if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],s=e[d][1],o=e[d][2];for(var r=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,s,o]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,o,a=n[0],r=n[1],l=n[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(l)var d=l(i)}for(t&&t(n);c<a.length;c++)o=a[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},n=self["webpackChunknewteztac"]=self["webpackChunknewteztac"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(9693)}));n=i.O(n)})();
//# sourceMappingURL=app.166566d1.js.map